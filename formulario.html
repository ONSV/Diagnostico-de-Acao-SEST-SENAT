<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autoavaliação Municipal ONSV</title>
    <link rel="stylesheet" href="form-style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <header class="main-header">
        <div class="container">
            <a href="index.html" class="logo">
                <img src="imagens/logo_observatorio-1.png" alt="Logo ONSV">
                <span>Diagnóstico de Ação - <strong>SEST SENAT</strong></span>
            </a>
        </div>
    </header>

    <main class="form-page">
        <div class="container form-container">

            <div class="alert alert-success">
                <i class="fas fa-check-circle"></i> <strong>Sistema de Proteção Ativo:</strong> O banco de dados agora
                possui proteção total contra dados incompletos. Avaliações com campos vazios serão automaticamente
                rejeitadas, garantindo a integridade dos dados.
            </div>

            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle"></i> <strong>Atenção:</strong> Todos os campos marcados com * são
                obrigatórios e protegidos por constraints de banco. O sistema impedirá automaticamente o salvamento se
                algum campo crítico estiver vazio.
            </div>

            <div class="form-header">
                <div class="header-icon">
                    <i class="fas fa-city"></i>
                </div>
                <h1>Dados</h1>
                <p>Preencha todos os dados básicos para iniciar a autoavaliação.</p>
            </div>

            <form action="#" method="POST" id="municipio-form">
                <fieldset>
                    <div class="form-section-header">
                        <i class="fas fa-info-circle"></i>
                        <h3>Dados Iniciais</h3>
                    </div>

                    <div class="form-group">
                        <label for="nome"><i class="fas fa-user"></i> Nome Completo * <span
                                class="required">OBRIGATÓRIO</span></label>
                        <input type="text" id="nome" name="nome" placeholder="Insira seu nome completo" required>
                    </div>

                    <div class="form-group">
                        <label for="cpf"><i class="fas fa-id-card"></i> CPF (Apenas Números) *</label>
                        <input type="text" id="cpf" name="cpf" placeholder="Insira seu CPF" required maxlength="14">
                    </div>

                    <div class="form-group-split">
                        <div class="form-group">
                            <label for="municipio"><i class="fas fa-map-marker-alt"></i> Município </label>
                            <select id="municipio" name="municipio" required disabled>
                                <option value="">Selecione o município</option>
                            </select>
                        </div>


                        <div class="form-group">
                            <label for="estado"><i class="fas fa-globe"></i> Estado/UF *</label>
                            <select id="estado" name="estado" required>
                                <option value="">Selecione o estado</option>
                            </select>
                        </div>
                    </div>

                </fieldset>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" id="btn-voltar"><i class="fas fa-arrow-left"></i>
                        Voltar</button>
                    <button type="submit" class="btn btn-primary">Continuar <i class="fas fa-arrow-right"></i></button>
                </div>
            </form>

            <div class="alert alert-info lgpd-alert">
                <i class="fas fa-shield-alt"></i>
                <p><strong>Aviso de Privacidade (LGPD):</strong></p>
                <p>Os dados solicitados neste questionário têm como finalidade exclusiva avaliar a percepção sobre
                    riscos e segurança viária dos participantes das ações educativas promovidas pelo SEST SENAT em
                    parceria com o Observatório Nacional de Segurança Viária (ONSV).</p>
                <p>As informações coletadas serão utilizadas apenas para fins de avaliação institucional e acadêmica do
                    Programa e poderão ser compartilhadas entre o SEST SENAT e o ONSV, garantindo-se o tratamento
                    responsável e seguro dos dados, conforme a Lei Geral de Proteção de Dados (Lei nº 13.709/2018).</p>
            </div>

        </div>
    </main>

    <script src="script.js"></script>

    <script>
        // função para pontuação no cpf
        document.getElementById("cpf").addEventListener("input", function (e) {
            let value = e.target.value.replace(/\D/g, ""); // remove tudo que não for número

            if (value.length > 11) value = value.slice(0, 11);

            value = value.replace(/^(\d{3})(\d)/, "$1.$2");
            value = value.replace(/^(\d{3})\.(\d{3})(\d)/, "$1.$2.$3");
            value = value.replace(/\.(\d{3})(\d)/, ".$1-$2");

            e.target.value = value;
        });

        // carregar estados
        fetch("https://servicodados.ibge.gov.br/api/v1/localidades/estados")
            .then(res => res.json())
            .then(estados => {
                estados.sort((a, b) => a.nome.localeCompare(b.nome));

                const selectEstado = document.getElementById("estado");

                estados.forEach(estado => {
                    const option = document.createElement("option");
                    option.value = estado.sigla;
                    option.textContent = estado.nome;
                    selectEstado.appendChild(option);
                });
            });

        // quando selecionar estado → carregar municípios
        document.getElementById("estado").addEventListener("change", function () {
            const estadoId = this.value;
            const municipioSelect = document.getElementById("municipio");

            municipioSelect.innerHTML = '<option>Carregando...</option>';
            municipioSelect.disabled = true;

            if (!estadoId) return;

            fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${estadoId}/municipios`)
                .then(res => res.json())
                .then(municipios => {
                    municipioSelect.innerHTML = '<option value="">Selecione o município</option>';

                    municipios.forEach(municipio => {
                        const option = document.createElement("option");
                        option.value = municipio.nome;
                        option.textContent = municipio.nome;
                        municipioSelect.appendChild(option);
                    });

                    municipioSelect.disabled = false;
                });
        });

        //Padronização de nomes
        const excecoes = ["de", "da", "do", "das", "dos"];

        function padronizarNome(nome) {
            return nome
                .toLowerCase()
                .split(" ")
                .map((palavra, index) => {
                    if (excecoes.includes(palavra) && index !== 0) {
                        return palavra;
                    }
                    return palavra.charAt(0).toUpperCase() + palavra.slice(1);
                })
                .join(" ");
        }

        const inputNome = document.getElementById("nome");

        inputNome.addEventListener("blur", function () {
            this.value = padronizarNome(this.value.trim());
        });

    </script>


</body>

</html>